saas_config:
  fides_key: hubspot_connector_example
  name: Hubspot SaaS Config
  description: A sample schema representing the Hubspot connector for Fidesops
  version: 0.0.1

  connector_params:
    - name: domain
    - name: api_key

  client_config:
    protocol: https
    host:
      connector_param: domain
    authentication:
      strategy: bearer_authentication
      configuration:
        token:
          connector_param: api_key

  test_request:
    path: /companies/v2/companies/paged

  endpoints:
    - name: contacts
      requests:
        read:
          path: /crm/v3/objects/contacts/search
          method: POST
          body: {
            "filter_groups": [{
              "filters": [{
                "value": <email>
                  "propertyName": "email"
                  "operator": "EQ"
              }
              ]
            }]
          }
          request_params:
            - name: email
              identity: email
            - name: limit
              type: query
              default_value: 100
          postprocessors:
            - strategy: unwrap
              configuration:
                data_path: results
          pagination:
            strategy: link
            configuration:
              source: body
              path: paging.next.link
        update:
          path: /crm/v3/objects/contacts/<contactId>
          method: PATCH
          body: {
            "properties": {
                <masked_object_fields>
            }
          }
          request_params:
            - name: contactId
              type: path
              references:
                - dataset: hubspot_connector_example
                  field: contacts_search.id
                  direction: from
    - name: owners
      requests:
        read:
          path: /crm/v3/owners
          request_params:
            - name: email
              type: query
              identity: email
            - name: limit
              type: query
              default_value: 100
          postprocessors:
            - strategy: unwrap
              configuration:
                data_path: results
          pagination:
            strategy: link
            configuration:
              source: body
              path: paging.next.link
    - name: marketing_emails
      requests:
        read:
          path: /marketing-emails/v1/emails
          method: GET
          request_params:
            - name: limit
              type: query
              default_value: 100
          data_path: objects
          postprocessors:
            - strategy: filter
              configuration:
                field: authorEmail  # or email?
                value:
                  identity: email
          pagination:
            strategy: offset
            configuration:
              incremental_param: offset
              increment_by: 100
              limit: 10000
        update:
          path: marketing-emails/v1/emails/<emailId>
          method: PUT
          request_params:
            - name: emailId
              type: path
              references:
                - dataset: hubspot_connector_example
                  field: marketing_emails.id
                  direction: from
    - name: subscription_preferences
      requests:
        read:
          path: /communication-preferences/v3/status/email/<email>
          method: GET
          data_path: subscriptionStatuses
          request_params:
            - name: email
              type: path
              identity: email
        update:
          path: /communication-preferences/v3/unsubscribe
          method: POST
          body: {
            "emailAddress": <email>,
            "subscriptionId": <subscriptionId>,
            "legalBasis": "LEGITIMATE_INTEREST_CLIENT",
            "legalBasisExplanation": "At users request, we opted them out"
          }
          request_params:
            - name: email
              type: body
              identity: email
            - name: subscriptionId
              type: body
              references:
                - dataset: hubspot_connector_example
                  field: subscription.id
                  direction: from
    - name: users
      requests:
        read:
          path: /settings/v3/users/
          method: GET
          request_params:
            - name: limit
              type: query
              default_value: 100
          pagination:
            strategy: link
            configuration:
              source: body
              path: paging.next.link
          postprocessors:
            - strategy: unwrap
              configuration:
                data_path: results
            - strategy: filter
              configuration:
                field: email
                value:
                  identity: email
    - name: user_provisioning
      requests:
        read:
          path: /settings/v3/users/<userId>
          method: GET
          request_params:
            - name: userId
              type: path
              references:
                - dataset: hubspot_connector_example
                  field: users.id
                  direction: from

